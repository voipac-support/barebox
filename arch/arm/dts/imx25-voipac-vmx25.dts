/*
 * Copyright 2012 Sascha Hauer, Pengutronix
 * Copyright 2014-2017 Voipac <support@voipac.com>
 *
 * The code contained herein is licensed under the GNU General Public
 * License. You may obtain a copy of the GNU General Public License
 * Version 2 or later at the following locations:
 *
 * http://www.opensource.org/licenses/gpl-license.html
 * http://www.gnu.org/copyleft/gpl.html
 */

/dts-v1/;
#include "imx25.dtsi"

/ {
	model = "Voipac VMX25";
	compatible = "voipac,imx25-vmx25", "fsl,imx25";

	chosen {
		linux,stdout-path = &uart1;

		environment@0 {
			compatible = "barebox,environment";
			device-path = &nfc, "partname:environment";
		};
	};

//	memory {
//		reg = <0x80000000 0x02000000 0x90000000 0x02000000>;
//	};

	leds {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_led>;

		red {
			label = "led-red";
			gpios = <&gpio2 4 0>;
			linux,default-trigger = "heartbeat";
		};

		orange {
			label = "led-orange";
			gpios = <&gpio2 5 0>;
			linux,default-trigger = "panic";
		};
	};

	regulators {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <0>;

		reg_dcdc1: regulator@0 {
			compatible = "regulator-fixed";
			regulator-name = "3v3";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			regulator-boot-on;
			regulator-always-on;
		};

		reg_dcdc2: regulator@1 {
			compatible = "regulator-fixed";
			regulator-name = "qvdd";
			regulator-min-microvolt = <1450000>;
			regulator-max-microvolt = <1450000>;
			regulator-boot-on;
			regulator-always-on;
		};

		reg_ldo1: regulator@2 {
			compatible = "regulator-fixed";
			regulator-name = "1v5";
			regulator-min-microvolt = <1500000>;
			regulator-max-microvolt = <1500000>;
			regulator-boot-on;
			regulator-always-on;
		};

		reg_ldo2: regulator@3 {
			compatible = "regulator-fixed";
			reg = <0>;
			regulator-name = "fec-phy";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			gpio = <&gpio4 9 0>;
		};

		reg_ldo3: regulator@4 {
			compatible = "regulator-fixed";
			regulator-name = "vdd-batt";
			regulator-min-microvolt = <1300000>;
			regulator-max-microvolt = <1300000>;
			regulator-boot-on;
			regulator-always-on;
		};

		reg_usb_host_vbus: regulator@5 {
			compatible = "regulator-fixed";
			regulator-name = "usb-host-vbus";
			regulator-min-microvolt = <5000000>;
			regulator-max-microvolt = <5000000>;
			gpio = <&gpio4 11 0>;
		};

		reg_usb_otg_vbus: regulator@6 {
			compatible = "regulator-fixed";
			regulator-name = "usb-otg-vbus";
			regulator-min-microvolt = <5000000>;
			regulator-max-microvolt = <5000000>;
			gpio = <&gpio1 0 0>;
		};
	};
};

&fec {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_fec>;
	phy-reset-gpios = <&gpio4 7 0>;
	phy-mode = "rmii";
	phy-supply = <&reg_ldo2>;
	status = "okay";
};

&iim {
	barebox,provide-mac-address = <&fec 0 26>;
};

&iomuxc {
	pinctrl_fec: fecgrp {
		fsl,pins = <
			MX25_PAD_D11__GPIO_4_9		0xD0 /* FEC PHY power on pin */
			MX25_PAD_D13__GPIO_4_7		0xD0 /* FEC reset */
			MX25_PAD_FEC_MDC__FEC_MDC	0x80000000
			MX25_PAD_FEC_MDIO__FEC_MDIO	0x80000000
			MX25_PAD_FEC_TDATA0__FEC_TDATA0	0x80000000
			MX25_PAD_FEC_TDATA1__FEC_TDATA1	0x80000000
			MX25_PAD_FEC_TX_EN__FEC_TX_EN	0x80000000
			MX25_PAD_FEC_RDATA0__FEC_RDATA0	0x80000000
			MX25_PAD_FEC_RDATA1__FEC_RDATA1	0x80000000
			MX25_PAD_FEC_RX_DV__FEC_RX_DV	0x80000000
			MX25_PAD_FEC_TX_CLK__FEC_TX_CLK	0x80000000
		>;
	};

	pinctrl_i2c1: i2c1grp {
		fsl,pins = <
			MX25_PAD_I2C1_CLK__I2C1_CLK	0x80000000
			MX25_PAD_I2C1_DAT__I2C1_DAT	0x80000000
		>;
	};

	pinctrl_led: ledgrp {
		fsl,pins = <
			MX25_PAD_A18__GPIO_2_4		0xC0
			MX25_PAD_A19__GPIO_2_5		0xC0
		>;
	};

	pinctrl_nfc: nfcgrp {
		fsl,pins = <
			MX25_PAD_NF_CE0__NF_CE0		0x80000000
			MX25_PAD_NFWE_B__NFWE_B		0x80000000
			MX25_PAD_NFRE_B__NFRE_B		0x80000000
			MX25_PAD_NFALE__NFALE		0x80000000
			MX25_PAD_NFCLE__NFCLE		0x80000000
			MX25_PAD_NFWP_B__NFWP_B		0x80000000
			MX25_PAD_NFRB__NFRB		0x80000000
			MX25_PAD_D7__D7			0x80000000
			MX25_PAD_D6__D6			0x80000000
			MX25_PAD_D5__D5			0x80000000
			MX25_PAD_D4__D4			0x80000000
			MX25_PAD_D3__D3			0x80000000
			MX25_PAD_D2__D2			0x80000000
			MX25_PAD_D1__D1			0x80000000
			MX25_PAD_D0__D0			0x80000000
		>;
	};

	pinctrl_uart1: uart1grp {
		fsl,pins = <
			MX25_PAD_UART1_TXD__UART1_TXD 0x80000000
			MX25_PAD_UART1_RXD__UART1_RXD 0x80000000
			MX25_PAD_UART1_CTS__UART1_CTS 0x80000000
			MX25_PAD_UART1_RTS__UART1_RTS 0x80000000
		>;
	};

	pinctrl_uart2: uart2grp {
		fsl,pins = <
			MX25_PAD_UART2_TXD__UART2_TXD 0x80000000
			MX25_PAD_UART2_RXD__UART2_RXD 0x80000000
			MX25_PAD_UART2_CTS__UART2_CTS 0x80000000
			MX25_PAD_UART2_RTS__UART2_RTS 0x80000000
		>;
	};

	pinctrl_usb_otg: usbotggrp {
		fsl,pins = <
//			MX25_PAD_GPIO_A__USBOTG_PWR	0x80000000
//			MX25_PAD_GPIO_B__USBOTG_OC	0x80000000
			MX25_PAD_GPIO_A__GPIO_A		0xD0
			MX25_PAD_GPIO_B__GPIO_B		0XD0
		>;
	};

	pinctrl_usb_host: usbhostgrp {
		fsl,pins = <
//			MX25_PAD_D9__USBH2_PWR		0x80000000
//			MX25_PAD_D8__USBH2_OC		0x80000000
			MX25_PAD_D9__GPIO_4_11		0xD0
			MX25_PAD_D8__GPIO_4_12		0xD0
		>;
	};
};

&nfc {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_nfc>;
	#address-cells = <1>;
	#size-cells = <1>;
	nand-on-flash-bbt;
	nand-ecc-mode = "hw";
	nand-bus-width = <8>;
	status = "okay";

	partition@0 {
		label = "bootloader";
		reg = <0x0 0x80000>;
	};

	partition@80000 {
		label = "environment";
		reg = <0x80000 0x80000>;
	};

	partition@100000 {
		label = "kernel";
		reg = <0x100000 0x400000>;
	};

	partition@500000 {
		label = "rootfs";
		/*
		 * Size 0x0 extends partition to end of nand flash.
		 */
//		reg = <0x500000 0x7b00000>;
		reg = <0x500000 0>;
	};
};

&uart1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart1>;
	status = "okay";
};

&uart2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart2>;
	status = "okay";
};

&usbhost1 {
	phy_type = "serial";
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usb_host>;
	vbus-supply = <&reg_usb_host_vbus>;
	status = "okay";
};

&usbotg {
	phy_type = "utmi";
	dr_mode = "peripheral";
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usb_otg>;
	vbus-supply = <&reg_usb_otg_vbus>;
	status = "okay";
};
